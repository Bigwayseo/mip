define("mip-html-ajax/mip-html-ajax",["require","customElement","zepto","viewport"],function(t){function e(t,e,n){if("undefined"==typeof t.set)return!1;else return n.find("val-input, val-textarea, val-select,val-option").each(function(){var t=d(this).prop("outerHTML");d(this).prop("outerHTML",t.replace(/<(\/?)val-/gi,"<$1"))}),n.find(t.set.btn).click(function(){return i(t,n),!1}),void e.addEventListener("keydown",function(e){if(13===e.keyCode)return i(t,n),!1},!1)}function i(t,e){if("undefined"==typeof t.val)return c(h.r102),!1;var i={};for(var r in t.val)if(t.val.hasOwnProperty(r)){var o=e.find(t.val[r]),s=o.attr("val-alt")||"",a=o.attr("min-len")||0,l=o.attr("max-len")||0,u=""!==s?s:h.d100.replace("{name}",r);if("*"===a&&0===o.val().length)return c(u),!1;if(0!==a&&o.val().length<a)return c(u),!1;if(0!==l&&o.val().length>l)return c(u),!1;i[r]=o.val()}n(t,e,i)}function n(t,e,i){var n=t.add.url,r=e.find(t.set.btn);if(""!==n){var o="undefined"!=typeof t.add.call?t.add.call:"";n=n.replace("{sid}",t.id),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:o,data:i,beforeSend:function(){if(r.attr("disabled","disabled"),""!==t.set.btnstr)r.attr("btn-txt",r.val()).val(t.set.btnstr)},error:function(){if("1"===t.add.tip)c(h.g100);if(r.removeAttr("disabled"),""!==t.set.btnstr)r.val(r.attr("btn-txt"))},success:function(i){if("err"===i.success)c(i.msg);else{var n="undefined"!=typeof t.tmp?1:0,o=1===n?d(t.tmp.nta).html():s(t.nta),l=1===n?d(t.tmp.ntr).html():s(t.ntr),u=e.find(t.res.upval).val();if(e.find("[empty=true]").val(""),""!==i.msg)c(i.msg);if("0"===u){var p=a(o,i);e.find(t.obj.list).append(p)}else{var h=a(l,i),m=e.find(t.obj.list).find("#Q"+u);m.find(t.obj.listre).append(h),f.setScrollTop(m.offset().top)}}if(r.removeAttr("disabled"),""!==t.set.btnstr)r.val(r.attr("btn-txt"))}})}}function r(t,e,i){var n=t.get.url;if(""!==n){var r="undefined"!=typeof t.get.call?t.get.call:"";n=n.replace("{id}",t.id).replace("{page}",i),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:r,error:function(){if("1"===t.get.tip)c(h.g101);if("undefined"!=typeof t.obj.nodata)if("1"===t.obj.nodata)e.remove()},success:function(i){if("err"===i.state)c(i.msg);else{if("undefined"!=typeof i[t.obj.arr]){var n=i[t.obj.arr],r=n.length;if(r>0){var o="undefined"!=typeof t.tmp?1:0,u=1===o?d(t.tmp.hta).html():s(t.hta),f=1===o?d(t.tmp.htr).html():s(t.htr),h="";if("undefined"!=typeof t.obj.arrs)n=l(n);if(!isNaN(t.obj.arrn))r=t.obj.arrn>=r?r:t.obj.arrn;for(var m=0;m<r;m++){var g=a(u,n[m]);if(g.indexOf("$ReData$")>0&&""!==t.obj.rearr){var y="",v=n[m][t.obj.rearr].length;if("undefined"!=typeof t.obj.rearrs)n[m][t.obj.rearr]=l(n[m][t.obj.rearr]);if(!isNaN(t.obj.rearrn))v=t.obj.rearrn>=v?v:t.obj.rearrn;for(var b=0;b<v;b++)y+=a(f,n[m][t.obj.rearr][b]);g=g.replace("$ReData$",y)}h+=g}e.find(t.obj.list).append(h)}else if("undefined"!=typeof t.obj.nodata)if("1"===t.obj.nodata)e.remove()}var _=e.find(t.obj.more);if("undefined"!=typeof i.size&&"undefined"!=typeof i.page&&""!==t.obj.more){var w=_.attr("more-txt")||"",k=i.size,x=i.page;if(k>x){if(""!==w)_.html(w);_.show(),_.attr("on","tap:"+p+".Qmore("+(x+1)+")")}else _.remove()}else _.remove()}}})}}function o(t,e,i){e.addEventAction("Qres",function(e,n){i.find(t.res.show).show().find(t.res.upint).text(n),f.setScrollTop(i.find(t.set.txt).offset().top);var r=setTimeout(function(){i.find(t.set.txt).focus(),clearTimeout(r)},200)}),e.addEventAction("Qreh",function(e,n){i.find(t.res.show).hide().find("em").text(0);var r=setTimeout(function(){i.find(t.set.txt).blur(),clearTimeout(r)},200)}),e.addEventAction("Qrev",function(e,n){i.find(t.res.upval).val(n)}),e.addEventAction("Qmore",function(e,n){var o=i.find(t.obj.more);o.attr("more-txt",o.html()).html(s(t.obj.morestr)),r(t,i,n)}),e.addEventAction("Qdig",function(e,i){var n=t.dig.url;if(""!==n){var r="undefined"!=typeof t.dig.call?t.dig.call:"";n=n.replace("{sid}",i),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:r,error:function(){if("1"===t.dig.tip)c(h.g102)},success:function(i){if("err"===i.success){if("1"===t.dig.tip)c(i.msg)}else if("1"===t.dig.tip)d(e.target).prepend('<i class="Qdig">+1</i>'),d(e.target).find(".Qdig").fadeOut(800,function(){d(this).remove()}),d(e.target).find("em").text(i.dig);d(e.target).removeAttr("on")}})}}),e.addEventAction("Qbad",function(e,i){var n=t.bad.url;if(""!==n){var r="undefined"!=typeof t.bad.call?t.bad.call:"";n=n.replace("{sid}",i),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:r,error:function(){if("1"===t.bad.tip)c(h.g103)},success:function(i){if("err"===i.success){if("1"===t.bad.tip)c(i.msg)}else if("1"===t.bad.tip)d(e.target).prepend('<i class="Qbad">+1</i>'),d(e.target).find(".Qbad").fadeOut(800,function(){d(this).remove()}),d(e.target).find("em").text(i.bad);d(e.target).removeAttr("on")}})}})}function s(t){var e=t;return e=e.replace(/\[\[/g,"<"),e=e.replace(/\]\]/g,">"),e=e.replace(/\|\|/g,"/"),e=e.replace(/\:\:/g,'"'),e=e.replace(/\;\;/g,"'"),e=e.replace(/\+\+/g," ")}function a(t,e){t=t.replace(/{thisid}/gi,p);var i=t.match(/{\w+}/gi);if(i)for(var n=0;n<i.length;n++){var r=i[n].match(/{(\w+)}/i);t=t.replace(i[n],e[r[1]])}return t}function l(t){var e=[];for(var i in t)if(t.hasOwnProperty(i))e.push(t[i]);for(var n=[],r=0;r<t.length&&e.length>0;r++){var o=Math.floor(Math.random()*e.length);n[r]=e[o],e.splice(o,1)}return n}function c(t,e){if(e=e||1600,d(".mip-html-ajax-tip").length>0)d(".mip-html-ajax-tip").remove();d("body").append('<div class="mip-html-ajax-tip">'+t+"</div>");var i=setTimeout(function(){d(".mip-html-ajax-tip").fadeOut(100,function(){d(this).remove()}),clearTimeout(i)},e)}var u=t("customElement").create(),d=t("zepto"),f=t("viewport"),p="Qping",h={r100:"获取配置json失败",r101:"配置json格式错误",r102:"获取配置json.val错误",d100:"{name}格式不正确",g100:"提交请求出错",g101:"获取请求出错",g102:"dig请求出错",g103:"bad请求出错"};return u.prototype.build=function(){var t=this.element,i=d(t),n=i.find("script[type$=json]"),s=i.attr("id");if(s)p=s;else i.attr("id",p);if(0===n.length)return i.html(h.r100),!1;try{var a=JSON.parse(n.text())}catch(t){return i.html(h.r101),!1}r(a,i,1),e(a,t,i),o(a,this,i)},u}),define("mip-html-ajax",["mip-html-ajax/mip-html-ajax"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-html-ajax",e,".mip-html-ajax-tip{width:72%;position:fixed;top:40%;left:10%;background:rgba(0,0,0,0.6);color:#fff;text-align:center;padding:15px 4%;line-height:22px;border-radius:6px;font-size:15px;z-index:999999}")}if(window.MIP)require(["mip-html-ajax"],function(e){t(window.MIP,e)});else require(["mip","mip-html-ajax"],t)}();
define("extensions/mip-down-comment/1.2/mip-down-comment",["require","zepto","customElement"],function(require){function validate(){var e=$(".w-text textarea").val(),t=e.length,o=e.replace(/[\x00-\xff]/g,"").length,i=Math.ceil((t+o)/2);5>i?$("#verify").addClass("disable"):$("#verify").removeClass("disable")}function comment(o){function time(e){var t="";return t+=[e.getFullYear(),e.getMonth()+1,e.getDate()].join("/"),t.replace(/(-|\:)(\d[^\d])/g,"$10$2")}function setCookie(e,t){var o=new Date;o.setTime(o.getTime()+12e4),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}function getCookie(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(o))?unescape(t[2]):null}function writeComment(){oli=oul.find("li"),$.ajax({data:{content:$(".w-text textarea").val(),SoftID:oid,Action:2,CommentTpye:$("#CommentTpye").val()||0},beforeSend:function(){return $("#submit #verify").hasClass("disable")?(alert("您评论写的太短啦！"),!1):1==getCookie("oldTime"+oid)?(alert("您评论次数太频繁啦！"),!1):void 0},success:function(){var e='<li><p class="user">您发表的跟贴<time><font color="red">'+time(new Date)+"</font></time></p><p>"+$(".w-text textarea").val()+"<p></li>";0==oli.length?oul.html(e):oli.first().before(e),$("#comment #submit").hide(),$("#view-comment").show(),$(".w-text textarea").val("").focus(),setCookie("oldTime"+oid,"1")}})}function readComment(){oli=oul.find("li"),p=Math.floor(oli.length/5+1),$.ajax({type:"get",url:"/sajax.asp",data:"action=0&id="+oid+"&page="+p+"&CommentTpye=0",success:function(data){for(var html="",data=eval("("+data+")"),userName=data.sUserName,userForm=data.sUserForm,userData=data.sDateAndTime,userText=data.sContent,i=0;i<userName.length;i++)html+='<li><p class="user">'+userForm[i]+userName[i]+"<time>"+userData[i]+"</time></p><p>"+decodeURIComponent(userText[i])+"</p></li>";data.RecordCount>5&&($("#view-comment .button-status-complete").css("display","block"),$("#comment .button").show()),p>=data.PageCount&&$("#view-comment .button").val("没有更多评论了！").attr("disabled",!0),0==oli.length?oul.html(html):oli.last().after(html)}})}var oul=$("#comment-list"),oid=$("#app-id").val(),oli=oul.find("li"),p=Math.floor(oli.length/5+1);$("#submit #verify").click(function(){return writeComment(),!1}),readComment(),$("#view-comment .button").click(function(){readComment()}),$("#view-comment header .fb").click(function(){$("#view-comment").css("display","none"),$("#submit").css("display","block")}),$("#cancel").click(function(){$("#view-comment").css("display","block"),$("#submit").css("display","none")}),$(".w-text textarea").keyup(validate)}var $=require("zepto"),customElem=require("customElement").create();return customElem.prototype.build=function(){var e=this.element;comment(e)},customElem}),require(["extensions/mip-down-comment/1.2/mip-down-comment"],function(e){MIP.registerMipElement("mip-down-comment",e)});
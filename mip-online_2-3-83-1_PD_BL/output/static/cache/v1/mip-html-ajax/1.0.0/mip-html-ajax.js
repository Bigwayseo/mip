define("mip-html-ajax/mip-html-ajax",["require","customElement","zepto","viewport"],function(e){function t(e,t,i){if("undefined"==typeof e.set)return!1;else return i.find("val-input, val-textarea, val-select,val-option").each(function(){var e=d(this).prop("outerHTML");d(this).prop("outerHTML",e.replace(/<(\/?)val-/gi,"<$1"))}),i.find(e.set.btn).click(function(){return n(e,i),!1}),void t.addEventListener("keydown",function(t){if(13===t.keyCode)return n(e,i),!1},!1)}function n(e,t){if("undefined"==typeof e.val)return l(h.r102),!1;var n={};for(var r in e.val)if(e.val.hasOwnProperty(r)){var o=t.find(e.val[r]),s=o.attr("val-alt")||"",a=o.attr("min-len")||0,u=o.attr("max-len")||0,c=""!==s?s:h.d100.replace("{name}",r);if("*"===a&&0===o.val().length)return l(c),!1;if(0!==a&&o.val().length<a)return l(c),!1;if(0!==u&&o.val().length>u)return l(c),!1;n[r]=o.val()}i(e,t,n)}function i(e,t,n){var i=e.add.url,r=t.find(e.set.btn);if(""!==i){i=i.replace("{sid}",e.id);var o=u(i)?"jsonp":"json";d.ajax({url:i,type:e.add.type,dataType:o,data:n,beforeSend:function(){if(r.attr("disabled","disabled"),""!==e.set.btnstr)r.attr("btn-txt",r.val()).val(e.set.btnstr)},error:function(){if("1"===e.add.tip)l(h.g100);if(r.removeAttr("disabled"),""!==e.set.btnstr)r.val(r.attr("btn-txt"))},success:function(n){if("err"===n.success)l(n.msg);else{var i="undefined"!=typeof e.tmp?1:0,o=1===i?d(e.tmp.nta).html():s(e.nta),u=1===i?d(e.tmp.ntr).html():s(e.ntr),c=t.find(e.res.upval).val();if(t.find("[empty=true]").val(""),""!==n.msg)l(n.msg);if("0"===c){var p=a(o,n);t.find(e.obj.list).append(p)}else{var h=a(u,n),m=t.find(e.obj.list).find("#Q"+c);m.find(e.obj.listre).append(h),f.setScrollTop(m.offset().top)}}if(r.removeAttr("disabled"),""!==e.set.btnstr)r.val(r.attr("btn-txt"))}})}}function r(e,t,n){var i=e.get.url;if(""!==i){i=i.replace("{id}",e.id).replace("{page}",n);var r=u(i)?"jsonp":"json";d.ajax({url:i,type:e.get.type,dataType:r,error:function(){if("1"===e.get.tip)l(h.g101);if("undefined"!=typeof e.obj.nodata)if("1"===e.obj.nodata)t.remove()},success:function(n){if("err"===n.state)l(n.msg);else{if("undefined"!=typeof n[e.obj.arr])if(n[e.obj.arr].length>0){for(var i="undefined"!=typeof e.tmp?1:0,r=1===i?d(e.tmp.hta).html():s(e.hta),o=1===i?d(e.tmp.htr).html():s(e.htr),u="",c=0;c<n[e.obj.arr].length;c++){var f=a(r,n[e.obj.arr][c]);if(f.indexOf("$ReData$")>0&&""!==e.obj.rearr){for(var h="",m=0;m<n[e.obj.arr][c][e.obj.rearr].length;m++)h+=a(o,n[e.obj.arr][c][e.obj.rearr][m]);f=f.replace("$ReData$",h)}u+=f}t.find(e.obj.list).append(u)}else if("undefined"!=typeof e.obj.nodata)if("1"===e.obj.nodata)t.remove();var g=t.find(e.obj.more);if("undefined"!=typeof n.size&&"undefined"!=typeof n.page&&""!==e.obj.more){var y=g.attr("more-txt")||"",v=n.size,b=n.page;if(v>b){if(""!==y)g.html(y);g.show(),g.attr("on","tap:"+p+".Qmore("+(b+1)+")")}else g.remove()}else g.remove()}}})}}function o(e,t,n){t.addEventAction("Qres",function(t,i){n.find(e.res.show).show().find(e.res.upint).text(i),f.setScrollTop(n.find(e.set.txt).offset().top);var r=setTimeout(function(){n.find(e.set.txt).focus(),clearTimeout(r)},200)}),t.addEventAction("Qreh",function(t,i){n.find(e.res.show).hide().find("em").text(0);var r=setTimeout(function(){n.find(e.set.txt).blur(),clearTimeout(r)},200)}),t.addEventAction("Qrev",function(t,i){n.find(e.res.upval).val(i)}),t.addEventAction("Qmore",function(t,i){var o=n.find(e.obj.more);o.attr("more-txt",o.html()).html(e.obj.morestr),r(e,n,i)}),t.addEventAction("Qdig",function(t,n){var i=e.dig.url;if(""!==i){i=i.replace("{sid}",n);var r=u(i)?"jsonp":"json";d.ajax({url:i,type:e.dig.type,dataType:r,error:function(){if("1"===e.dig.tip)l(h.g102)},success:function(e){if("err"===e.success)l(e.msg);else d(t.target).prepend('<i class="Qdig">+1</i>'),d(t.target).find(".Qdig").fadeOut(800,function(){d(this).remove()}),d(t.target).find("em").text(e.dig),d(t.target).removeAttr("on")}})}}),t.addEventAction("Qbad",function(t,n){var i=e.bad.url;if(""!==i){i=i.replace("{sid}",n);var r=u(i)?"jsonp":"json";d.ajax({url:i,type:e.bad.type,dataType:r,error:function(){if("1"===e.bad.tip)l(h.g103)},success:function(e){if("err"===e.success)l(e.msg);else d(t.target).prepend('<i class="Qbad">+1</i>'),d(t.target).find(".Qbad").fadeOut(800,function(){d(this).remove()}),d(t.target).find("em").text(e.bad),d(t.target).removeAttr("on")}})}})}function s(e){var t=e;return t=t.replace(/\[\[/g,"<"),t=t.replace(/\]\]/g,">"),t=t.replace(/\|\|/g,"/"),t=t.replace(/\:\:/g,'"'),t=t.replace(/\;\;/g,"'"),t=t.replace(/\+\+/g," ")}function a(e,t){e=e.replace(/{thisid}/gi,p);var n=e.match(/{\w+}/gi);if(n)for(var i=0;i<n.length;i++){var r=n[i].match(/{(\w+)}/i);e=e.replace(n[i],t[r[1]])}return e}function l(e,t){if(t=t||1600,d(".mip-html-ajax-tip").length>0)d(".mip-html-ajax-tip").remove();d("body").append('<div class="mip-html-ajax-tip">'+e+"</div>");var n=setTimeout(function(){d(".mip-html-ajax-tip").fadeOut(100,function(){d(this).remove()}),clearTimeout(n)},t)}function u(e){var t=!1,n=/^(http|https):\/\//i;if(n.exec(e))t=!0;else t=!1;return t}var c=e("customElement").create(),d=e("zepto"),f=e("viewport"),p="Qping",h={r100:"获取配置json失败",r101:"配置json格式错误",r102:"获取配置json.val错误",d100:"{name}格式不正确",g100:"提交请求出错",g101:"获取请求出错",g102:"dig请求出错",g103:"bad请求出错"};return c.prototype.build=function(){var e=this.element,n=d(e),i=n.find("script[type$=json]"),s=n.attr("id");if(s)p=s;else n.attr("id",p);if(0===i.length)return n.html(h.r100),!1;try{var a=JSON.parse(i.text())}catch(e){return n.html(h.r101),!1}r(a,n,1),t(a,e,n),o(a,this,n)},c}),define("mip-html-ajax",["mip-html-ajax/mip-html-ajax"],function(e){return e}),function(){function e(e,t){e.registerMipElement("mip-html-ajax",t,".mip-html-ajax-tip{width:72%;position:fixed;top:40%;left:10%;background:rgba(0,0,0,0.6);color:#fff;text-align:center;padding:15px 4%;line-height:22px;border-radius:6px;font-size:15px;z-index:999999}")}if(window.MIP)require(["mip-html-ajax"],function(t){e(window.MIP,t)});else require(["mip","mip-html-ajax"],e)}();